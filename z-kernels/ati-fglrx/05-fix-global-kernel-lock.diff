#
# From http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=618831
#
--- fglrx-driver-11-2/common/lib/modules/fglrx/build_mod/firegl_public.c.old	2011-03-18 14:51:25.000000000 -0400
+++ fglrx-driver-11-2/common/lib/modules/fglrx/build_mod/firegl_public.c	2011-03-18 14:52:33.000000000 -0400
@@ -1913,13 +1913,17 @@
 /** \brief Grab global kernel lock */
 void ATI_API_CALL KCL_GlobalKernelLock(void)
 {
+#ifdef CONFIG_KERNEL_LOCK
     lock_kernel();
+#endif
 }
 
 /** \brief Release global kernel lock */
 void ATI_API_CALL KCL_GlobalKernelUnlock(void)
 {
+#ifdef CONFIG_KERNEL_LOCK
     unlock_kernel();
+#endif
 }
 
 /*****************************************************************************/
